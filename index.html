<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Launcher</title>
</head>
<body>
  <!-- embed the full executor page as plain text so we never need to escape backticks -->
  <script id="executor-template" type="text/plain">
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>HTML Executor</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; }
    html, body { margin:0; padding:0; overflow-x:hidden; }
    body {
      background-color:#2b0000;
      color:#f0d0d0;
      font-family:sans-serif;
      margin:1em;
    }
    h1 { color:#ff5555; margin-bottom:.5em; }
    .controls {
      background-color:#330000;
      border:1px solid #550000;
      padding:1em;
      border-radius:4px;
      max-width:800px;
      margin:auto;
    }
    label { display:block; margin-top:.75em; font-weight:bold; }
    input[type=file], input[type=text], textarea {
      background-color:#440000;
      color:#f0d0d0;
      border:1px solid #660000;
      border-radius:3px;
      padding:.5em;
      font-family:monospace;
      width:100%;
    }
    textarea { height:20vh; resize:vertical; }
    button {
      background-color:#770000;
      color:#f0d0d0;
      border:1px solid #990000;
      border-radius:3px;
      padding:.5em 1em;
      margin-top:.5em;
      cursor:pointer;
      font-weight:bold;
    }
    button:disabled {
      background-color:#550000;
      border-color:#770000;
      cursor:not-allowed;
      opacity:.6;
    }
    button:hover:not(:disabled) {
      background-color:#990000;
      border-color:#bb0000;
    }
  </style>
</head>
<body>
  <h1>HTML Executor</h1>
  <div class="controls">
    <label>
      Upload .html or .txt file:
      <input type="file" id="fileInput" accept=".html,.txt">
    </label>
    <button id="runFileBtn" disabled>Run Uploaded File</button>

    <label>
      Paste your HTML code here:
      <textarea id="codeInput" placeholder="&lt;h1&gt;Hello world&lt;/h1&gt;"></textarea>
    </label>
    <button id="runCodeBtn">Run Code</button>

    <label>
      Load HTML from URL:
      <input type="text" id="urlInput" placeholder="https://example.com/page.html">
    </label>
    <button id="fetchUrlBtn">Fetch & Run</button>
  </div>

  <script>
    let uploadedContent = null;
    function openInNewTab(html) {
      const blob = new Blob([html], { type: 'text/html' });
      const url  = URL.createObjectURL(blob);
      window.open(url, '_blank');
      setTimeout(() => URL.revokeObjectURL(url), 60000);
    }

    // File upload handling
    document.getElementById('fileInput').addEventListener('change', e => {
      const f = e.target.files[0];
      uploadedContent = null;
      document.getElementById('runFileBtn').disabled = true;
      if (!f) return;
      const reader = new FileReader();
      reader.onload = ev => {
        uploadedContent = ev.target.result;
        document.getElementById('runFileBtn').disabled = false;
      };
      reader.readAsText(f);
    });
    document.getElementById('runFileBtn').addEventListener('click', () => {
      if (uploadedContent) openInNewTab(uploadedContent);
    });

    // Run code from textarea
    document.getElementById('runCodeBtn').addEventListener('click', () => {
      const code = document.getElementById('codeInput').value;
      if (!code.trim()) return alert('Paste some HTML code first!');
      openInNewTab(code);
    });

    // Fetch & run from URL
    document.getElementById('fetchUrlBtn').addEventListener('click', () => {
      const u = document.getElementById('urlInput').value.trim();
      if (!u) return alert('Enter a URL first');
      fetch(u)
        .then(r => r.ok ? r.text() : Promise.reject(`Status ${r.status}`))
        .then(html => openInNewTab(html))
        .catch(err => alert('Fetch error: ' + err));
    });
  </script>
</body>
</html>
  </script>

  <script>
    // immediately grab the template and spin up the executor
    const tpl = document.getElementById('executor-template').textContent;
    const blob = new Blob([tpl], { type: 'text/html' });
    const url  = URL.createObjectURL(blob);
    // replace current page with the executor page
    window.location.replace(url);
  </script>

  <p>Loadingâ€¦</p>
</body>
</html>
